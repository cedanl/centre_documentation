<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Corneel den Hartogh">
<meta name="dcterms.date" content="2024-02-07">

<title>Ways of working</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="ways_of_working_files/libs/clipboard/clipboard.min.js"></script>
<script src="ways_of_working_files/libs/quarto-html/quarto.js"></script>
<script src="ways_of_working_files/libs/quarto-html/popper.min.js"></script>
<script src="ways_of_working_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ways_of_working_files/libs/quarto-html/anchor.min.js"></script>
<link href="ways_of_working_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ways_of_working_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ways_of_working_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ways_of_working_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ways_of_working_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#ways-of-working" id="toc-ways-of-working" class="nav-link active" data-scroll-target="#ways-of-working">Ways of working</a></li>
  <li><a href="#activities" id="toc-activities" class="nav-link" data-scroll-target="#activities">Activities</a></li>
  <li><a href="#general" id="toc-general" class="nav-link" data-scroll-target="#general">General</a>
  <ul class="collapse">
  <li><a href="#sharing-progress-asynchronously" id="toc-sharing-progress-asynchronously" class="nav-link" data-scroll-target="#sharing-progress-asynchronously">Sharing progress asynchronously</a></li>
  <li><a href="#repository-guidelines" id="toc-repository-guidelines" class="nav-link" data-scroll-target="#repository-guidelines">Repository guidelines</a></li>
  <li><a href="#open-source" id="toc-open-source" class="nav-link" data-scroll-target="#open-source">Open Source</a></li>
  </ul></li>
  <li><a href="#data-analytics" id="toc-data-analytics" class="nav-link" data-scroll-target="#data-analytics">Data analytics</a>
  <ul class="collapse">
  <li><a href="#data-analytics-guidelines-repositories" id="toc-data-analytics-guidelines-repositories" class="nav-link" data-scroll-target="#data-analytics-guidelines-repositories">Data analytics guidelines: Repositories</a></li>
  <li><a href="#data-analytics-guidelines-language" id="toc-data-analytics-guidelines-language" class="nav-link" data-scroll-target="#data-analytics-guidelines-language">Data analytics guidelines: Language</a></li>
  <li><a href="#data-analytics-guidelines-content-of-repository" id="toc-data-analytics-guidelines-content-of-repository" class="nav-link" data-scroll-target="#data-analytics-guidelines-content-of-repository">Data analytics guidelines: Content of repository</a></li>
  <li><a href="#data-analytics-guidelines-project" id="toc-data-analytics-guidelines-project" class="nav-link" data-scroll-target="#data-analytics-guidelines-project">Data analytics guidelines: Project</a></li>
  <li><a href="#data-analytics-guidelines-steps-towards-goals" id="toc-data-analytics-guidelines-steps-towards-goals" class="nav-link" data-scroll-target="#data-analytics-guidelines-steps-towards-goals">Data analytics guidelines: Steps towards goals</a></li>
  </ul></li>
  <li><a href="#data-engineering" id="toc-data-engineering" class="nav-link" data-scroll-target="#data-engineering">Data engineering</a>
  <ul class="collapse">
  <li><a href="#data-engineering-guidelines-activities" id="toc-data-engineering-guidelines-activities" class="nav-link" data-scroll-target="#data-engineering-guidelines-activities">Data engineering guidelines: Activities</a></li>
  <li><a href="#data-engineering-guidelines-packages" id="toc-data-engineering-guidelines-packages" class="nav-link" data-scroll-target="#data-engineering-guidelines-packages">Data engineering guidelines: Packages</a></li>
  <li><a href="#data-engineering-guidelines-containerization" id="toc-data-engineering-guidelines-containerization" class="nav-link" data-scroll-target="#data-engineering-guidelines-containerization">Data engineering guidelines: Containerization</a></li>
  <li><a href="#data-engineering-guidelines-integration" id="toc-data-engineering-guidelines-integration" class="nav-link" data-scroll-target="#data-engineering-guidelines-integration">Data engineering guidelines: Integration</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="ways_of_working.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Ways of working</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Corneel den Hartogh </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 7, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="ways-of-working" class="level2">
<h2 class="anchored" data-anchor-id="ways-of-working">Ways of working</h2>
<p>CEDA is a project within the pilot hub ‘Studiedata &amp; AI’ (Educational data &amp; AI) of the Npuls program. ADD_LINK This repository is used to document the ways of working within CEDA. This document discusses what type of activities CEDA executes and how this is done. Another document will discuss what our goals are and why these are the goals. In addition, there are certain procedural basics that are needed for collaboration, like getting access etc. These are discussed in the basics document ADD_LINK.</p>
</section>
<section id="activities" class="level2">
<h2 class="anchored" data-anchor-id="activities">Activities</h2>
<p>CEDA delivers the following types of activities:</p>
<ol type="1">
<li>Data Analytics
<ul>
<li>Think of data preparation, modelling and dashboarding of educational data.</li>
<li>We build and actively share code for data analytics of national available data through public repositories</li>
</ul></li>
<li>Data Engineering
<ul>
<li>Think of containerization, connectors to storage, analytics developer environments</li>
<li>We build and actively share code and technical configuration for open source tooling that supports the sharing and (re-)usage of the data analytics repositories</li>
</ul></li>
<li>Alignment &amp; Coordination
<ul>
<li>Think of community contact, reference architecture and the role of analytics in flexibilisation</li>
<li>We ensure that the results of the first two activities are aligned with:
<ol type="1">
<li>the practical needs of (data analists in) educational institutions</li>
<li>the technical needs of the national IT infrastructure</li>
<li>the strategic vision for Dutch tertiary education</li>
</ol></li>
</ul></li>
</ol>
<p>These activities all have their own specific guidelines and requirements. However, some overarching ways of work can be defined.</p>
</section>
<section id="general" class="level1">
<h1>General</h1>
<section id="sharing-progress-asynchronously" class="level2">
<h2 class="anchored" data-anchor-id="sharing-progress-asynchronously">Sharing progress asynchronously</h2>
<p>Since we all have other responsibilities (at our primary employer) and don’t see each other daily, it is important to share our progress transparently and asynchronously. See the basics document for a link.</p>
<p>For guidelines per story see:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task guidelines
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Always use EPIC: Centre for Educational Data Analytics (CEDA)</li>
<li>Always use a label to signify the ‘product’ the task contributes to</li>
<li>A clear description per task of what is expected in max 5 sentences</li>
<li>A task should take approximately a day of actual work</li>
<li>Use the checklist or comments to document details and show progress</li>
</ul>
</div>
</div>
</div>
</section>
<section id="repository-guidelines" class="level2">
<h2 class="anchored" data-anchor-id="repository-guidelines">Repository guidelines</h2>
<p>CEDA strives to have clear names for repositories since they might be growing.</p>
<p>All commit messages should be in British English and have the style:</p>
<p>&lt;type&gt;: &lt;specification&gt;</p>
<p>Types should be, if reasonably possible, chosen from the following list:</p>
<table class="table">
<caption>Commit style</caption>
<colgroup>
<col style="width: 10%">
<col style="width: 89%">
</colgroup>
<thead>
<tr class="header">
<th>type</th>
<th>usage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>fix</td>
<td>For commits that fix bugs</td>
</tr>
<tr class="even">
<td>add</td>
<td>For commits that add new functionality</td>
</tr>
<tr class="odd">
<td>temp</td>
<td>For commits that have temporary code</td>
</tr>
<tr class="even">
<td>style</td>
<td>For commits that focus on style improvements</td>
</tr>
<tr class="odd">
<td>update</td>
<td>For commits that primarily update because data has been renewed</td>
</tr>
<tr class="even">
<td>del</td>
<td>For commits that primarily remove scripts or code</td>
</tr>
<tr class="odd">
<td>move</td>
<td>For commits that primarily move scripts and code</td>
</tr>
</tbody>
</table>
<p>This makes commits much more easy to navigate and overview.</p>
</section>
<section id="open-source" class="level2">
<h2 class="anchored" data-anchor-id="open-source">Open Source</h2>
<p>Open source is more than publishing code on github. Also, it is not only a technical or marketing choice but aligned with our place in the public sector. See our goals document for more information (NOT YET AVAILABLE). Practically this means that there are specific guidelines set up for public code in public sector. CEDA strives to conform to these guidelines.</p>
<p>See for instance, the omprehensive general standard from <a href="https://github.com/publiccodenet/standard/releases">public code</a>. Regarding open source, we are in close contact with the <a href="https://www.surf.nl/en/news/kick-off-community-open-source-program-office-ospo">SURF OSPO</a> and others within Npuls.</p>
<p>Currently, there is no set SURF policy regarding open source. Until there is, we have a couple of guidelines and considerations:</p>
<ul>
<li><p>For now, we will use the MIT licence. It is widely used and respected and easy to interpret.</p></li>
<li><p>For now, we will publish on Github. It is a commercial US-based platform, but the most widely used for open source software and it has many features. Potentially, alternatives like <a href="https://code.europa.eu/" class="uri">https://code.europa.eu/</a> and <a href="https://opencode.de/" class="uri">https://opencode.de/</a> might be considered.</p>
<ul>
<li><p>Within Github you don’t have to allow Github to use your code for Github Copilot. Go in the top right corner to your avatar and click on ‘Copilot’. Make sure there is no checkmark at:</p></li>
<li><p><img src="images/clipboard-3266355048.png" class="img-fluid"></p></li>
</ul></li>
<li><p>A drawback of open source is that, even with the limitations of this license and not offically allowing Github to use the code for Copilot, code might still be scraped without permission for commercial purposes like monetizing LLMs. This an inherent drawback about open source.</p></li>
</ul>
</section>
</section>
<section id="data-analytics" class="level1">
<h1>Data analytics</h1>
<section id="data-analytics-guidelines-repositories" class="level2">
<h2 class="anchored" data-anchor-id="data-analytics-guidelines-repositories">Data analytics guidelines: Repositories</h2>
<p>Data analytics repositories are either one of the following:</p>
<ol type="1">
<li>Data product (from raw data to clean, validated and enriched data)
<ul>
<li>Does enriched belong to this or do we want to separate between clean &amp; validated and enriched?</li>
<li>In practice it is often mixed (for isntance, you enrich it to help with validation)</li>
</ul></li>
<li>Analysis product (based on data product but enriched with a model-based prediction)</li>
<li>Information product (based on either a data or analysis product, but a visualization or sort of summary)
<ul>
<li>Q: Is dashboard or final product a better name?</li>
</ul></li>
</ol>
</section>
<section id="data-analytics-guidelines-language" class="level2">
<h2 class="anchored" data-anchor-id="data-analytics-guidelines-language">Data analytics guidelines: Language</h2>
<p>Code of CEDA should be open source and machine readable. We support the following:</p>
<ul>
<li><p>Python</p></li>
<li><p>R</p></li>
<li><p>Tableau</p></li>
<li><p>PowerBI</p></li>
</ul>
<p>While Tableau and PowerBI are itself not open source, we can still deliver the logic of the dashboards open. We hope to be able to move from Tableau en PowerBI to fully open source solutions, but currently Tableau and PowerBI match the practical needs of our community</p>
<p>Q: Should we include other tooling or have at some point a survey about tooling?</p>
</section>
<section id="data-analytics-guidelines-content-of-repository" class="level2">
<h2 class="anchored" data-anchor-id="data-analytics-guidelines-content-of-repository">Data analytics guidelines: Content of repository</h2>
<p>Based upon: <a href="https://github.com/publiccodenet/standard/releases/" class="uri">https://github.com/publiccodenet/standard/releases/</a></p>
<ol type="1">
<li><p>Every repository has code that runs successfully</p></li>
<li><p>There is a config file which has a setting for at least every institution-specific setting</p>
<ul>
<li>For instance, links to file locations, the name or BRIN of the institution, etc</li>
</ul></li>
<li><p>A build file. All code can be run (see 1) by triggering one file</p></li>
<li><p>An instruction file which explains at least the goal of the data manipulation in this repository and the context (how the acquire the start data or a reference to a working example of a final product).</p></li>
<li><p>Every repository has a clear structure in line with the language-specific best practices for data science</p>
<ul>
<li>As CEDA we strive to define our own language-specific structure</li>
</ul></li>
<li><p>Data dictionaries at start and end</p>
<ul>
<li>All the start data has a clear dictionary with metadata and meaning. This also goes for the resulting product
<ul>
<li>As CEDA we strive to have common dictionaries based on the type of repository (data, analysis or information) regardless of specific language</li>
</ul></li>
</ul></li>
<li><p>Well styled code, also language specific</p>
<ul>
<li>As CEDA we strive to more precise guidelines about code, in order to make repositories more alike each other</li>
</ul></li>
<li><p>All files are machine-readable (.py, .R, .csv., .yaml, md, qmd).</p></li>
<li><p>All the data files at start and end of the repository are automatically checked by validation rules</p>
<ul>
<li>As CEDA we strive to have uniform data validation rules</li>
</ul></li>
<li><p>Every repository has synthetic or dummy ‘start’ data</p></li>
<li><p>The main language in a repository is English. This goes for code, comments, documentation and column names. For specific terms a glossary can be provided.</p>
<ul>
<li>As CEDA we strive to align the glossaries over all repositories</li>
<li>Something like column names might be difficult / confusing for users (at first).</li>
</ul></li>
<li><p>Every repository is ‘complete’. It has synthetic data, necessary metadata, config, documentation, etc, within.</p></li>
</ol>
<p>Question: Am I missing something? Or can things be removed?</p>
<p>Question: What about the order?</p>
</section>
<section id="data-analytics-guidelines-project" class="level2">
<h2 class="anchored" data-anchor-id="data-analytics-guidelines-project">Data analytics guidelines: Project</h2>
<p>One project will often have more than one repository (for instance: a data product repository and an information product repository). So in addition to the repository, there are additional goals:</p>
<ol type="1">
<li>A working demo example oriented at end-users based on synthetic or dummy data</li>
<li>A blog oriented at end-users to describe the whole project, some interesting real world insights about your own institution and potentially something about the embedding within your own institution</li>
<li>One or more workshops with data science professionals from other educational institutions to get it working for them</li>
</ol>
</section>
<section id="data-analytics-guidelines-steps-towards-goals" class="level2">
<h2 class="anchored" data-anchor-id="data-analytics-guidelines-steps-towards-goals">Data analytics guidelines: Steps towards goals</h2>
<p>Of course, data analytics is never done. The list above at contents of repository does not need to be achieved 100% in order to have a successful project. In addition, the starting point of specific sub-projects will differ.</p>
<p>Therefore, every lead of a subproject discusses with the CEDA project lead what the next few steps are (no need to plan the whole thing in detail, since we work agile).</p>
</section>
</section>
<section id="data-engineering" class="level1">
<h1>Data engineering</h1>
<section id="data-engineering-guidelines-activities" class="level2">
<h2 class="anchored" data-anchor-id="data-engineering-guidelines-activities">Data engineering guidelines: Activities</h2>
<p>The first set of repositories is about getting from raw data to useful information products. The data engineering part is about making it easy to set up and develop these repositories and making it easy to share and re-use this.</p>
<ul>
<li><p>Developing useful functions and packages that can be used to run code from the data analytics repositories</p></li>
<li><p>Developing useful functions and packages that can be used within the data analytics repositories</p></li>
<li><p>Setting up Docker containers and Docker config files to support the usage other data science professionals usage of these repositories</p></li>
<li><p>Experiment and potentially facilitate connection to SURF tooling and other open source solutions</p></li>
</ul>
</section>
<section id="data-engineering-guidelines-packages" class="level2">
<h2 class="anchored" data-anchor-id="data-engineering-guidelines-packages">Data engineering guidelines: Packages</h2>
<p>Packages follow the standards for packages in the language they are written. This includes:</p>
<ol type="1">
<li>Publication in the most prominent package repositories: Pypi for Python and CRAN for R</li>
<li>Usage of package tools that enable (re)building of packages like poetry for Python or devtools for R</li>
<li>Github actions on every package repository to automatically check the (re)build</li>
<li>At least a README and Github Page about the specific package and its usage</li>
</ol>
</section>
<section id="data-engineering-guidelines-containerization" class="level2">
<h2 class="anchored" data-anchor-id="data-engineering-guidelines-containerization">Data engineering guidelines: Containerization</h2>
<p>Docker is de-facto standard so we will use this as well. We have the concept of analytics-in-a-box-in-a-box-… highlighting the several possibilities of boxing.</p>
<ul>
<li><p>For instance, taking a data analytics repository, allowing the user to override the config settings to include local files, run all the code and provide the user locally with the resulting ‘data product’</p></li>
<li><p>An important element in containerization is to find the limits of what we can get to work and document also the ‘failures’. This is important, because CEDA could, if deemed useful, hire an external professional for advanced data engineering.</p></li>
</ul>
</section>
<section id="data-engineering-guidelines-integration" class="level2">
<h2 class="anchored" data-anchor-id="data-engineering-guidelines-integration">Data engineering guidelines: Integration</h2>
<p>This is currently out-of-scope. SURF has already several services for research data storage, cloud services, etc. In the coming months we will connect with these groups to see what is already available, but no practical engineering will be done.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>